<Page x:Class="MigracaoAD.UI.Views.EnvironmentPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <ScrollViewer>
    <StackPanel Margin="0">
      <TextBlock Text="Ambiente &amp; Configura√ß√£o" FontSize="24" FontWeight="Bold" Margin="0,0,0,8"/>
      <TextBlock Text="Configure os servidores usando o sistema de agentes (recomendado) ou credenciais tradicionais."
                 Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,24"/>

      <!-- Configura√ß√£o do Agente (PRIORIDADE) -->
      <Border Style="{StaticResource Card}" Background="#1E3A8A" BorderBrush="#3B82F6" BorderThickness="2">
        <StackPanel>
          <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
            <TextBlock Text="ü§ñ" FontSize="24" Margin="0,0,8,0"/>
            <TextBlock Text="Sistema de Agentes (Recomendado)" FontSize="18" FontWeight="Bold" Foreground="White"/>
          </StackPanel>

          <TextBlock TextWrapping="Wrap" Foreground="#93C5FD" Margin="0,0,0,16" FontSize="13">
            ‚úÖ Mais simples: S√≥ precisa de IP + Token (sem usu√°rio/senha!)
            <LineBreak/>
            ‚úÖ Mais r√°pido: Conex√£o direta HTTP (sem WinRM/Kerberos)
            <LineBreak/>
            ‚úÖ Mais confi√°vel: Funciona entre dom√≠nios diferentes
            <LineBreak/>
            ‚úÖ Mais seguro: Token √∫nico, firewall autom√°tico
          </TextBlock>

          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="16"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="16"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
              <Label Content="Token de autentica√ß√£o" Foreground="White"/>
              <TextBox Text="{Binding AgentToken, Mode=TwoWay}"
                       ToolTip="Token usado para autenticar com os agentes (mesmo token em ambos os servidores)"
                       FontWeight="Bold"/>
            </StackPanel>

            <StackPanel Grid.Column="2">
              <Label Content="Porta do agente" Foreground="White"/>
              <TextBox Text="{Binding AgentPort, Mode=TwoWay}"
                       ToolTip="Porta onde o agente est√° escutando (padr√£o: 8765)"/>
            </StackPanel>

            <StackPanel Grid.Column="4" VerticalAlignment="Bottom">
              <Button Content="üìñ Guia de Instala√ß√£o" Click="ShowAgentGuide_Click"
                      Background="#3B82F6" Foreground="White" MinWidth="150"
                      ToolTip="Como instalar o agente nos servidores"/>
            </StackPanel>
          </Grid>

          <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
            <Button Content="üîå Testar Origem" Click="TestAgentSource_Click" MinWidth="150"
                    Background="#10B981" Foreground="White" FontWeight="Bold"
                    ToolTip="Testa se o agente est√° respondendo no servidor origem"/>
            <Button Content="üîå Testar Destino" Click="TestAgentTarget_Click" MinWidth="150"
                    Background="#10B981" Foreground="White" FontWeight="Bold"
                    ToolTip="Testa se o agente est√° respondendo no servidor destino"/>
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- Informa√ß√µes dos Servidores -->
      <Border Style="{StaticResource Card}">
        <StackPanel>
          <TextBlock Text="üìã Informa√ß√µes dos Servidores" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,16"/>

          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="16"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Coluna Origem -->
            <StackPanel Grid.Column="0">
              <TextBlock Text="üñ•Ô∏è Servidor Origem (Local)" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12" Foreground="{DynamicResource Accent}"/>

              <Label Content="Dom√≠nio origem"/>
              <TextBox Text="{Binding SourceDomainName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                       ToolTip="Ex.: abzservicos.local"/>

              <Label Content="DC origem (hostname/IP)"/>
              <TextBox Text="{Binding SourceDcHost, Mode=TwoWay}"/>

              <Label Content="IP DC origem" FontWeight="Bold"/>
              <TextBox Text="{Binding SourceDcIp, Mode=TwoWay}"
                       ToolTip="IP do servidor origem (necess√°rio para o agente)"
                       Background="#FEF3C7" BorderBrush="#F59E0B" BorderThickness="2"/>

              <Label Content="FileServer origem"/>
              <TextBox Text="{Binding SourceFileServer, Mode=TwoWay}"/>
            </StackPanel>

            <!-- Coluna Destino -->
            <StackPanel Grid.Column="2">
              <TextBlock Text="‚òÅÔ∏è Servidor Destino (Nuvem)" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12" Foreground="{DynamicResource Accent}"/>

              <Label Content="Dom√≠nio destino"/>
              <TextBox Text="{Binding TargetDomainName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                       ToolTip="Ex.: corp.local"/>

              <Label Content="DC destino (hostname/IP)"/>
              <TextBox Text="{Binding TargetDcHost, Mode=TwoWay}"/>

              <Label Content="IP DC destino" FontWeight="Bold"/>
              <TextBox Text="{Binding TargetDcIp, Mode=TwoWay}"
                       ToolTip="IP do servidor destino (necess√°rio para o agente)"
                       Background="#FEF3C7" BorderBrush="#F59E0B" BorderThickness="2"/>

              <Label Content="FileServer destino"/>
              <TextBox Text="{Binding DestinationFileServer, Mode=TwoWay}"/>
            </StackPanel>
          </Grid>
        </StackPanel>
      </Border>

      <!-- Bot√µes de A√ß√£o -->
      <Border Style="{StaticResource Card}">
        <StackPanel>
          <TextBlock Text="üõ†Ô∏è A√ß√µes R√°pidas" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"/>

          <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
            <Button x:Name="AutoDetectBtn" Content="üîç Auto-Detectar" Click="AutoDetect_Click" MinWidth="150"
                    ToolTip="Detecta automaticamente o dom√≠nio e DC atual"/>
            <Button Content="üåê Escanear Rede" Click="ScanNetwork_Click" MinWidth="150"
                    ToolTip="Escaneia a rede local em busca de servidores"/>
          </StackPanel>

          <Separator Margin="0,8,0,8"/>
          <TextBlock Text="‚öôÔ∏è Configura√ß√£o Autom√°tica via Agente" FontSize="13" FontWeight="SemiBold" Margin="0,0,0,8"/>
          <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,8" FontSize="11">
            Configura automaticamente: IP est√°tico, DNS, firewall, roles (AD DS, DFS, File Server) e discos.
          </TextBlock>

          <StackPanel Orientation="Horizontal">
            <Button x:Name="ConfigureSourceBtn" Content="‚öôÔ∏è Configurar Servidor Origem" Click="ConfigureSource_Click"
                    MinWidth="200" Background="#10B981" Foreground="White" FontWeight="Bold"/>
            <Button x:Name="ConfigureTargetBtn" Content="‚öôÔ∏è Configurar Servidor Destino" Click="ConfigureTarget_Click"
                    MinWidth="200" Background="#10B981" Foreground="White" FontWeight="Bold"/>
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- IPs Detectados com Bot√µes de Copiar -->
      <Border x:Name="DetectedIPsPanel" Style="{StaticResource Card}" Background="{DynamicResource SelectedBg}" Visibility="Collapsed">
        <StackPanel>
          <TextBlock Text="üìã IPs Detectados - Clique para Copiar" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"/>
          <StackPanel x:Name="DetectedIPsList" Orientation="Vertical"/>
        </StackPanel>
      </Border>

      <!-- Credenciais Tradicionais (Fallback) -->
      <Border Style="{StaticResource Card}" Background="#422006" BorderBrush="#78350F" BorderThickness="1">
        <StackPanel>
          <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
            <TextBlock Text="‚ö†Ô∏è" FontSize="18" Margin="0,0,8,0"/>
            <TextBlock Text="Credenciais Tradicionais (Fallback - N√£o Recomendado)" FontSize="14" FontWeight="SemiBold" Foreground="#FCD34D"/>
          </StackPanel>

          <TextBlock TextWrapping="Wrap" Foreground="#FDE68A" Margin="0,0,0,12" FontSize="11">
            Use apenas se o agente n√£o estiver dispon√≠vel. Requer configura√ß√£o complexa de WinRM/SSH/PSExec.
          </TextBlock>

          <Expander Header="Mostrar Campos de Credenciais" Foreground="#FCD34D">
            <Grid Margin="0,12,0,0">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <!-- Credenciais Origem -->
              <StackPanel Grid.Column="0">
                <TextBlock Text="üîê Origem" FontWeight="SemiBold" Margin="0,0,0,8" Foreground="#FCD34D"/>

                <Label Content="Usu√°rio" Foreground="#FDE68A"/>
                <TextBox Text="{Binding SourceUsername, Mode=TwoWay}"/>

                <Label Content="Senha" Foreground="#FDE68A"/>
                <PasswordBox x:Name="SourcePasswordBox" PasswordChanged="SourcePassword_Changed"/>

                <Label Content="M√©todo" Foreground="#FDE68A"/>
                <ComboBox x:Name="SourceConnectionMethod" SelectedIndex="0">
                  <ComboBoxItem Content="WinRM"/>
                  <ComboBoxItem Content="SSH"/>
                  <ComboBoxItem Content="PSExec"/>
                </ComboBox>
              </StackPanel>

              <!-- Credenciais Destino -->
              <StackPanel Grid.Column="2">
                <TextBlock Text="üîê Destino" FontWeight="SemiBold" Margin="0,0,0,8" Foreground="#FCD34D"/>

                <Label Content="Usu√°rio" Foreground="#FDE68A"/>
                <TextBox Text="{Binding TargetUsername, Mode=TwoWay}"/>

                <Label Content="Senha" Foreground="#FDE68A"/>
                <PasswordBox x:Name="TargetPasswordBox" PasswordChanged="TargetPassword_Changed"/>

                <Label Content="M√©todo" Foreground="#FDE68A"/>
                <ComboBox x:Name="TargetConnectionMethod" SelectedIndex="0">
                  <ComboBoxItem Content="WinRM"/>
                  <ComboBoxItem Content="SSH"/>
                  <ComboBoxItem Content="PSExec"/>
                </ComboBox>
              </StackPanel>
            </Grid>
          </Expander>
        </StackPanel>
      </Border>

      <Border Style="{StaticResource Card}" Background="{DynamicResource AppBg}">
        <TextBlock x:Name="DetectOut" TextWrapping="Wrap" FontFamily="Consolas" FontSize="12"/>
      </Border>


    </StackPanel>
  </ScrollViewer>
</Page>

